<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <title>chat room</title>

    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>

    <py-config>
		[[fetch]]
      	files = ["/request.py"]
    </py-config>
  </head>

  <body>
    <div id="main">
        <h4 id="cntto">Connected to None</h4>
        <input id="message" type="text">
		<button id="setname" py-click="setname()">Set name</button>
        <button id="create" py-click="create()">Create</button>
        <button id="cnt" py-click="connect()">Connect</button>
        <button id="send" py-click="send()">Send</button>
        <p id="displayerror"></p>
    </div>
    <div id="prevmsg">

    </div>
    <py-script>
        import asyncio
		import json
		from request import request
		
		username = "user"
		url = "https://my-json-server.typicode.com/RahulM-3/user-apis/db" # message room api
		
		async def send(): # send message to room
			text = Element("message")
			if(text.element.value != ""):
				pass
		
		async def connect(): # connect to a room
			#connecting to a json room
			text = Element("message")
			if(text.element.value == ""):
				Element("displayerror").element.innerText = "Enter a unique code to join a room"
			else:
				username = "person1"
				Element("displayerror").element.innerText = ""
				roomname = text.element.value+"-room"
				Element("cntto").element.innerText = "Connected to "+roomname
				btns = Element("send")
				btns.element.style.visibility = "visible";
				
				btnc = Element("create")
				btnc.element.remove()

				btn = Element("cnt")
				btn.element.remove()
		
		async def create(): # create a room
			if(generaldata["totalrooms"] == 5): # display error if server (json) is full
				Element("displayerror").element.innerText = "Server is full!, try again later"
				return

			# creating room in server (json)
			text = Element("message")
			if(text.element.value == ""):
				Element("displayerror").element.innerText = "Enter a unique code to create room"
			else:
				global username
				username+="1"

				Element("displayerror").element.innerText = ""
				roomname = text.element.value+"-room"
				Element("cntto").element.innerText = "Connected to "+roomname


				# buttom manipulation
				btns = Element("send")
				btns.element.style.visibility = "visible";

				btn = Element("create")
				btn.element.remove()

				btnc = Element("cnt")
				btnc.element.remove()

    </py-script>
  </body>
</html>